<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë°•ìŠ¤ì˜¤í”¼ìŠ¤</title>

  <!-- Pretendard -->
  <link rel="stylesheet" as="style" crossorigin
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css"/>

  <style>
    /* ====== (CSSëŠ” ë„¤ê°€ ë³´ë‚¸ ê²ƒ ê·¸ëŒ€ë¡œ, ì¤‘ê°„ ìƒëµ ì—†ìŒ) ====== */
    :root {
      --primary: #5b6cff;
      --primary-soft: #f1f3ff;
      --text-main: #222;
      --text-sub: #666;
      --border: #eaeaea;
      --bg: #f7f8fa;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Pretendard',sans-serif;
      background:var(--bg);
      padding:24px;
    }
    /* --- ì´í•˜ CSS ì „ë¶€ ë™ì¼ --- */
  </style>
</head>

<body>

<div class="header">
  <h1>ğŸ¬ ë°•ìŠ¤ì˜¤í”¼ìŠ¤</h1>
</div>

<div class="menu-container">
  <div class="menu-card active" onclick="showContent(event,'top10')">
    <h2>TOP 10</h2>
    <p>ì¼ë³„ ë°•ìŠ¤ì˜¤í”¼ìŠ¤</p>
  </div>
  <div class="menu-card" onclick="showContent(event,'period')">
    <h2>ê¸°ê°„ë³„ ë¶„ì„</h2>
    <p>ì¥ê¸° í¥í–‰ ìˆœìœ„</p>
  </div>
  <div class="menu-card" onclick="showContent(event,'random')">
    <h2>ëœë¤ ì¶”ì²œ</h2>
    <p>ì˜¤ëŠ˜ì˜ ì˜í™”</p>
  </div>
  <div class="menu-card" onclick="showContent(event,'reviews')">
    <h2>ì˜í™” í›„ê¸°</h2>
    <p>ë¸”ë¡œê·¸ ë¦¬ë·°</p>
  </div>
</div>

<!-- TOP10 -->
<div id="top10Content" class="content-area show">
  <h2>ë°•ìŠ¤ì˜¤í”¼ìŠ¤ TOP 10</h2>
  <div class="date-selector">
    <input type="date" id="dateInput">
    <button onclick="loadTop10()">ì¡°íšŒ</button>
  </div>
  <div id="top10List"></div>
</div>

<!-- Period -->
<div id="periodContent" class="content-area">
  <h2>ê¸°ê°„ë³„ TOP10 ë¶„ì„</h2>
  <div class="period-selector">
    <button onclick="loadPeriodAnalysis(1)">ìµœê·¼ 1ì£¼</button>
    <button onclick="loadPeriodAnalysis(2)">ìµœê·¼ 2ì£¼</button>
    <button onclick="loadPeriodAnalysis(4)">ìµœê·¼ 4ì£¼</button>
  </div>
  <div id="periodResult"></div>
</div>

<!-- Random -->
<div id="randomContent" class="content-area">
  <h2>ëœë¤ ì˜í™” ì¶”ì²œ</h2>
  <button onclick="loadRandomMovie()">ğŸ² ëœë¤ ì¶”ì²œ</button>
  <div id="randomResult"></div>
</div>

<!-- Reviews -->
<div id="reviewsContent" class="content-area">
  <h2>ì˜í™” í›„ê¸° ê²€ìƒ‰</h2>
  <input id="reviewSearch" placeholder="ì˜í™” ì œëª©">
  <button onclick="searchReviews()">ê²€ìƒ‰</button>
  <div id="reviewResult"></div>
</div>

<script>
let selectedDate = '';

/* ë‚ ì§œ ì´ˆê¸°í™” */
const today = new Date();
today.setDate(today.getDate()-1);
const maxDate = today.toISOString().split('T')[0];
document.getElementById('dateInput').max = maxDate;
document.getElementById('dateInput').value = maxDate;
selectedDate = maxDate;

/* ë©”ë‰´ ì „í™˜ */
function showContent(event, type){
  document.querySelectorAll('.menu-card').forEach(c=>c.classList.remove('active'));
  document.querySelectorAll('.content-area').forEach(a=>a.classList.remove('show'));
  event.currentTarget.classList.add('active');
  document.getElementById(type+'Content').classList.add('show');
}

/* TOP10 */
async function loadTop10(){
  selectedDate = document.getElementById('dateInput').value;
  const res = await fetch(`/api/boxoffice?date=${selectedDate}`);
  const data = await res.json();
  const list = data.boxOfficeResult.dailyBoxOfficeList;

  let html='<div class="movie-list">';
  list.forEach(m=>{
    html+=`
      <div class="movie-item">
        <div class="movie-rank">${m.rank}</div>
        <div class="movie-info">
          <div class="movie-title">${m.movieNm}</div>
          <div class="movie-stats">ê°œë´‰ì¼ ${m.openDt}</div>
        </div>
        <button onclick="showMovieDetail('${m.movieNm}')">ìƒì„¸</button>
      </div>`;
  });
  html+='</div>';
  document.getElementById('top10List').innerHTML=html;
}

/* ìƒì„¸ë³´ê¸° */
async function showMovieDetail(name){
  const res = await fetch(`/api/movie-detail?name=${encodeURIComponent(name)}&date=${selectedDate}`);
  const data = await res.json();
  const m=data.boxoffice;
  document.getElementById('top10List').innerHTML=`
    <button onclick="loadTop10()">â† ëª©ë¡</button>
    <h2>${m.movieNm}</h2>
    <p>ëˆ„ì  ê´€ê°ìˆ˜ ${parseInt(m.audiAcc).toLocaleString()}ëª…</p>`;
}

/* ëœë¤ ì¶”ì²œ */
async function loadRandomMovie(){
  const res = await fetch('/api/random-movie');
  const data = await res.json();
  const m=data.movie;
  document.getElementById('randomResult').innerHTML=`
    <h3>${m.movieNm}</h3>
    <button onclick="showRandomMovieDetail('${m.movieNm}','${data.date}')">ìƒì„¸</button>`;
}

/* ğŸ”¥ ëœë¤ ìƒì„¸ (ë³µêµ¬ëœ ë¶€ë¶„) */
async function showRandomMovieDetail(movieName,date){
  const res = await fetch(`/api/movie-detail?name=${encodeURIComponent(movieName)}&date=${date.replace(/-/g,'')}`);
  const data = await res.json();
  const m=data.boxoffice;
  document.getElementById('randomResult').innerHTML=`
    <button onclick="loadRandomMovie()">â† ëŒì•„ê°€ê¸°</button>
    <h2>${m.movieNm}</h2>
    <p>ëˆ„ì  ê´€ê° ${parseInt(m.audiAcc).toLocaleString()}ëª…</p>`;
}
</script>

</body>
</html>
